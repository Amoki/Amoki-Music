function onYouTubeIframeAPIReady(){youtubePlayer=new YT.Player("youtubePlayer",{height:"100%",width:"100%",playerVars:{iv_load_policy:"3",modestbranding:"1",rel:"0",controls:"0"},events:{onReady:function(){youtubePlayer.initialized=!0,youtubePlayerControl.setVolume(getCookie("volumePlayer")),getCookie("playerOpen")&&"true"===getCookie("playerOpen")&&roomVM.room()&&roomVM.room().currentMusic()&&"youtube"===roomVM.room().currentMusic().source()&&roomVM.openPlayer()}}}),previewYoutubePlayer=new YT.Player("preview_player",{height:"300px",width:"100%",playerVars:{iv_load_policy:"3",modestbranding:"1",rel:"0",autoplay:"0"},events:{onReady:function(){previewYoutubePlayer.initialized=!0}}})}function WS4Redis(e){function o(e){console.log("Connecting to "+e+" ..."),l=new WebSocket(e),l.onopen=r,l.onmessage=s,l.onerror=n,l.onclose=i,u=null}function t(){p+=1,p>3&&(clearInterval(d),d=null,console.warn("Closing connection. Reason: Too many missed heartbeats."),l.close()),l.send(e.heartbeat_msg)}function r(){return console.log("Connected!"),c=1,e.heartbeat&&null===d&&(p=0,d=setInterval(t,5e3)),e.onOpen()}function i(){if(console.log("Connection closed!"),!u){var e=a(c);u=setTimeout(function(){c+=1,o(l.url)},e)}}function n(o){return console.error("Websocket connection is broken!"),e.onError(o)}function s(o){return o.data!==e.heartbeat?e.onMessage(JSON.parse(o.data)):void(p=0)}function a(e){var o=1e3*(Math.pow(2,e)-1);return o>3e4&&(o=3e4),Math.random()*o}var l,u,c=1,d=null,p=0;o(e.uri),this.send_message=function(e){l.send(e)},this.close=function(){l.onclose=function(){},l.onerror=function(){},u&&clearInterval(u),d&&clearInterval(d),l.close()}}function setupKoBootstrap(e,o){o.fn.outerHtml||(o.fn.outerHtml=function(){if(0===this.length)return!1;var e=this[0],t=e.tagName.toLowerCase();if(e.outerHTML)return e.outerHTML;var r=o.map(e.attributes,function(e){return e.name+'="'+e.value+'"'});return"<"+t+(r.length>0?" "+r.join(" "):"")+">"+e.innerHTML+"</"+t+">"}),e.bindingHandlers.popover={init:function(t,r,i,n,s){var a=o(t),l=e.utils.unwrapObservable(r()),u=l.template||!1,c=l.options||{title:"popover"},d=l.data||!1,p=l.controlDescendants;return u!==!1&&(d?c.content="<!-- ko template: { name: template, if: data, data: data } --><!-- /ko -->":c.content=o("#"+u).html(),c.html=!0),a.on("shown.bs.popover",function(t){var i=o(t.target).data(),n=i["bs.popover"].$tip,a=i["bs.popover"].options||{},l=o(t.target),c=l.position(),p={x:l.outerWidth(),y:l.outerHeight()};if(e.cleanNode(n[0]),d)ko.applyBindings({template:u,data:d},n[0]);else{var m=s.createChildContext(s.$rawData,null,function(e){ko.utils.extend(e,r())});ko.applyBindings(m,n[0])}var f={x:n.outerWidth(),y:n.outerHeight()};switch(n.find('button[data-dismiss="popover"]').click(function(){l.popover("hide")}),a.placement){case"right":n.css({left:p.x+c.left,top:p.y/2+c.top-f.y/2});break;case"left":n.css({left:c.left-f.x,top:p.y/2+c.top-f.y/2});break;case"top":n.css({left:c.left+(p.x/2-f.x/2),top:c.top-f.y});break;case"bottom":n.css({left:c.left+(p.x/2-f.x/2),top:c.top+p.y})}}),a.popover(c),e.utils.domNodeDisposal.addDisposeCallback(t,function(){a.popover("destroy")}),{controlsDescendantBindings:"undefined"==typeof p?!0:p}}}}function onWsOpen(){reconnectTry=0,loginVM.wsError(!1),roomVM.init(),musicsLibraryVM.init(),loginVM.wsConnected(!0)}function onWsError(){reconnectTry+=1,loginVM.wsError(!0),loginVM.wsConnected(!1),reconnectTry>6&&loginVM.logOut()}function receiveMessage(e){e.stop&&Object.keys(playerControlWrapper).forEach(function(e){playerControlWrapper[e].stop(),$(".player-child").not(".player-child-no-music").stop().fadeOut(250)}),e.action&&("play"!==e.action||"play"===e.action&&roomVM.playerOpen())&&(Object.keys(playerControlWrapper).forEach(function(o){o!==e.source&&playerControlWrapper[o].stop()}),playerControlWrapper[e.source][e.action](e.options)),e.update===!0&&(roomVM.getRoom(),roomVM.getPlaylist(),musicsLibraryVM.getLibrary())}function stopProgressBar(){$(document).attr("title","Amoki's musics"),$(".progress-bar").finish(),$(".progress-bar").css("width","0%"),$("#time-left-progress-bar").countTo("stop")}function humanizeSeconds(e){var o=[Math.floor(e/60)%60,e%60];return Math.floor(e/60/60)%24>0&&o.unshift(Math.floor(e/60/60)%24),$.map(o,function(e){return(10>e?"0":"")+e}).join(":")}function updateProgressBar(e,o,t,r){$(".progress-bar").finish(),$("#time-left-progress-bar").countTo({from:o,to:e,speed:1e3*r,refreshInterval:1e3,formatter:function(e,o){return humanizeSeconds(e.toFixed(o.decimals))},onUpdate:function(e){this.attr("currentTimePast",e)}}),$("#time-left-progress-bar").countTo("restart"),$(".progress-bar").width(t+"%").animate({width:"100%"},{duration:1e3*r,easing:"linear"})}function connectWs(e,o,t){"object"==typeof ws4redis&&ws4redis.close(),ws4redis=new WS4Redis({uri:o+e+"?subscribe-broadcast",onMessage:receiveMessage,heartbeat:t,onOpen:onWsOpen,onError:onWsError})}function setRoomConnexion(e,o,t){storeCookie("room_token",e),$.ajaxSetup({beforeSend:function(o){o.setRequestHeader("Authorization","Bearer "+e)}}),o&&t?(storeCookie("room_heartbeat",o),storeCookie("room_wsUri",t),connectWs(getCookie("room_token"),getCookie("room_wsUri"),getCookie("room_heartbeat"))):$.getJSON("/check_credentials",function(o){loginVM.isConnected(!0),storeCookie("room_heartbeat",o.heartbeat),storeCookie("room_wsUri",o.uri),connectWs(e,o.uri,o.heartbeat)}).fail(function(e){return loginVM.badLogin(!0),console.error(e.responseText),!1})}function logOutRoom(){removeCookie("room_token"),removeCookie("room_heartbeat"),removeCookie("room_wsUri"),ws4redis.close()}function logErrors(e,o,t){console.error(e.responseText),console.error("Statut : "+o),console.error("Error: "+t.stack)}function modalConfirm(e){e.modal({show:!0,backdrop:!1}).on("shown.bs.modal",function(){setTimeout(function(){e.modal("hide")},1e3)})}function Music(e){this.pk=ko.observable(e.pk),this.music_id=ko.observable(e.music_id),this.name=ko.observable(e.name),this.thumbnail=ko.observable(e.thumbnail),this.count=ko.observable(e.count||e.views),this.total_duration=ko.observable(e.total_duration),this.duration=ko.observable(e.duration),this.timer_start=ko.observable(e.timer_start),this.timer_end=ko.computed(function(){return this.timer_start()+this.duration()},this),this.url=ko.observable(e.url),this.room_id=ko.observable(e.room_id),this.source=ko.observable(e.source),this.channel_name=ko.observable(e.channel_name),this.description=ko.observable(e.description),this.from=e.from}function PlaylistTrack(e){this.pk=ko.observable(e.pk),this.order=ko.observable(e.order),this.music=ko.observable(new Music(e.music))}function Room(e){this.name=ko.observable(e.name),this.currentMusic=ko.observable(e.current_music?new Music(e.current_music):null),this.shuffle=ko.observable(e.shuffle),this.can_adjust_volume=ko.observable(e.can_adjust_volume),this.count_left=ko.observable(e.count_left),this.time_left=ko.observable(e.time_left),this.current_time_left=ko.observable(e.current_time_left),this.current_time_past=ko.observable(e.current_time_past),this.current_time_past_percent=ko.observable(e.current_time_past_percent)}function Source(e){this.name=ko.observable(e.capitalize())}function LibraryViewModel(){var e=this;e.musicsLibrary=ko.observableArray([]),e.hasPrevious=ko.observable(),e.hasNext=ko.observable(),e.currentPage=ko.observable(),e.musicSearch=ko.observableArray([]),e.sourceSearch=ko.observable(),e.querySearch=ko.observable().trimmed(),e.sources=ko.observableArray([]),e.musicPreview=ko.observable(),e.clear=function(){e.musicsLibrary([]),e.hasPrevious(null),e.hasNext(null),e.currentPage(null),e.musicSearch([]),e.sourceSearch(null),e.querySearch(null),e.sources([]),e.musicPreview(null)},e.addMusic=function(e){$.ajax("/music",{data:ko.toJSON(e),type:"post",contentType:"application/json",dataType:"json",success:function(){$("button.btn-add-music").removeClass("icon-refresh").children("span").attr("class","glyphicon glyphicon-play-circle"),$("button.btn-add-music").prop("disabled",!1),modalConfirm($("#modal-add-music"))}})},e.patchMusic=function(o,t){$.ajax("/music/"+o.pk(),{data:ko.toJSON(o),type:"patch",contentType:"application/json",dataType:"json",success:function(){t?e.addMusic(o):($("button.btn-add-music").removeClass("icon-refresh").children("span").attr("class","glyphicon glyphicon-play-circle"),$("button.btn-add-music").prop("disabled",!1),modalConfirm($("#modal-add-music")))}})},e.sendMusic=function(o,t){$("button.btn-add-music").addClass("icon-refresh").children("span").attr("class","fa fa-refresh fa-spin"),$("button.btn-add-music").prop("disabled",!0),"search"===o.from?e.addMusic(o):"library"===o.from&&("play"===t?e.addMusic(o):e.patchMusic(o,t))},e.openPreviewMusic=function(o){e.musicPreview(o);var t=e.musicPreview().timer_start()?e.musicPreview().timer_start():0,r=e.musicPreview().timer_end()?e.musicPreview().timer_end():e.musicPreview().total_duration();customSlider.slide({element:$("#slider-preview"),max:e.musicPreview().total_duration(),values:[t,r],currentPlayerControl:playerPreviewControlWrapper[o.source()]}),playerPreviewControlWrapper[o.source()].play({music_id:e.musicPreview().music_id()})},e.closePreviewMusic=function(o,t){$("#music_preview").modal("hide"),o&&(e.musicPreview().timer_start($("#slider-preview").slider("values",0)),e.musicPreview().duration(e.musicPreview().total_duration()-e.musicPreview().timer_start()-(e.musicPreview().total_duration()-$("#slider-preview").slider("values",1))),e.sendMusic(e.musicPreview(),t)),e.musicPreview(null)},e.deleteMusic=function(e){roomVM.deleteMusic(e)},e.searchMusic=function(){e.querySearch()&&($("button.btn-search-icon").children("i").attr("class","fa fa-refresh fa-spin"),$("button.btn-search-icon").prop("disabled",!0),$.getJSON("/search",{service:ko.toJS(e.sourceSearch).toLowerCase(),query:e.querySearch()},function(o){var t=$.map(o,function(e){return e.from="search",new Music(e)});e.musicSearch(t),$("#tab_btn_library, #library").removeClass("active"),$("#tab_btn_search, #search-tab").addClass("active"),$("button.btn-search-icon").children("i").attr("class","fa fa-search"),$("button.btn-search-icon").prop("disabled",!1)}).fail(function(e){console.error(e.responseText)}))},e.getLibrary=function(o,t){var r;r=t?t.target.value:"/musics?page_size="+pageSize,$.getJSON(r,function(o){var t=$.map(o.results,function(e){return e.from="library",new Music(e)});e.musicsLibrary(t),e.hasPrevious(o.previous),e.hasNext(o.next),$("#popover-container-custom").scrollTop(0)}).fail(function(e){console.error(e.responseText)})},e.getSources=function(){$.getJSON("/sources",function(o){var t=$.map(o,function(e){return new Source(e)});e.sources(t)}).fail(function(e){console.error(e.responseText)})},e.init=function(){e.getLibrary(),e.getSources()}}function RoomViewModel(){var e=this;e.room=ko.observable(),e.playlistTracks=ko.observableArray([]),getCookie("playerOpen")&&getCookie("playerOpen")!==!1?null:storeCookie("playerOpen",!1),e.playerOpen=ko.observable("true"===getCookie("playerOpen")),e.clear=function(){e.room(null),e.playlistTracks([]),e.playerOpen(!1),e.closePlayer()},e.openPlayer=function(){if(e.playerOpen(!0),storeCookie("playerOpen",!0),e.room().currentMusic()){Object.keys(playerControlWrapper).forEach(function(o){o!==e.room().currentMusic().source()&&playerControlWrapper[o].stop()});var o={music_id:e.room().currentMusic().music_id(),timer_start:e.room().currentMusic().timer_start()+$("#time-left-progress-bar").attr("currentTimePast")};playerControlWrapper[e.room().currentMusic().source()].play(o)}},e.closePlayer=function(){e.playerOpen(!1),storeCookie("playerOpen",!1),$("#tab_btn_playlist").hasClass("active")&&($("#tab_btn_playlist, #playlist").removeClass("active"),$("#tab_btn_library, #library").addClass("active")),Object.keys(playerControlWrapper).forEach(function(e){playerControlWrapper[e].stop()})},e.getRoom=function(){$.getJSON("/room",function(o){e.room(new Room(o)),e.room().currentMusic()?updateProgressBar(e.room().currentMusic().duration(),e.room().current_time_past(),e.room().current_time_past_percent(),e.room().current_time_left()):stopProgressBar()}).fail(function(e){console.error(e.responseText)})},e.getPlaylist=function(){$.getJSON("/playlist",function(o){var t=$.map(o,function(e){return new PlaylistTrack(e)});e.playlistTracks(t)}).fail(function(e){console.error(e.responseText)})},e.patchShuffle=function(){e.room().shuffle(!e.room().shuffle()),$.ajax({url:"/room",data:ko.toJSON({shuffle:e.room().shuffle}),type:"patch",contentType:"application/json",dataType:"json",success:function(o){e.room(new Room(o)),modalConfirm(e.room().shuffle()?$("#modal-shuffle-on"):$("#modal-shuffle-off"))},error:logErrors})},e.postNext=function(){$.ajax("/room/next",{data:ko.toJSON({music_pk:e.room().currentMusic().pk()}),type:"post",contentType:"application/json",dataType:"json",success:function(o){e.room(new Room(o)),modalConfirm($("#modal-next-music"))},error:logErrors})},e.postPlaylistSort=function(e,o,t){t="undefined"==typeof t?"":t,$(".overlay-playlist").show();var r="/playlist";r+=e?"/"+e:"",r+=o?"/"+o:"",r+=t?"/"+t:"",$.ajax({url:r,type:"post",contentType:"application/json",dataType:"json",success:function(){$(".overlay-playlist").hide()},error:logErrors})},e.deleteMusic=function(o){var t=o?o.pk():e.room().currentMusic().pk();$.ajax("/music/"+t,{type:"delete",contentType:"application/json",dataType:"json",success:function(){musicsLibraryVM.musicsLibrary.remove(o),modalConfirm($("#modal-delete-music"))},error:logErrors})},e.deletePlaylistTrack=function(o){e.playlistTracks.remove(o),$.ajax("/playlist/"+o.pk(),{type:"delete",contentType:"application/json",dataType:"json",success:function(){modalConfirm($("#modal-delete-playlistTrack"))},error:logErrors})},e.init=function(){e.getRoom(),e.getPlaylist()}}function LoginViewModel(){var e=this;e.isConnected=ko.observable(!1),e.wsConnected=ko.observable(!1),e.wsError=ko.observable(!1),e.badLogin=ko.observable(!1),e.rooms=ko.observableArray([]),e.password=ko.observable().trimmed(),e.selectedRoom=ko.observable(),e.getRooms=function(){$.getJSON("/rooms",function(o){var t=$.map(o.results,function(e){return new Room(e)});e.rooms(t)}).fail(function(e){console.error(e.responseText)})},e.getLogin=function(){e.password()&&e.selectedRoom()?$.getJSON("/login",{name:e.selectedRoom(),password:e.password()},function(o){roomVM.room(new Room(o.room)),e.isConnected(!0),setRoomConnexion(o.room.token,o.websocket.heartbeat,o.websocket.uri)}).fail(function(o){e.badLogin(!0),console.error(o.responseText)}):e.badLogin(!0)},e.logOut=function(){e.isConnected(!1),e.wsConnected(!1),e.wsError(!1),roomVM.clear(),musicsLibraryVM.clear(),logOutRoom(),e.getRooms()}}function resize(){var e;e=$(window).height()>765?$(window).height()-($("#navbar-top").outerHeight(!0)+$("footer.foot").outerHeight(!0)+25):650,$(".remote, .LIB").height(e),$(".list-lib").height(e-90),$(".tab-content").height(e-130),$(".list-lib .panel-playlist").height(e-160),$(".players, .playlist-mid").height(e-250)}function updateVolume(e){Object.keys(playerControlWrapper).forEach(function(o){storeCookie("volumePlayer",e),playerControlWrapper[o].setVolume(e)})}function displaySlider(e){var o=$("#slider-volume").children(".ui-slider-handle").offset();$(".tooltip-volume-player").css("top",o.top-40).css("left",o.left-5).text(e);var t=$("#icon-volume");0===e?t.css("background-position","0 -103px"):10>=e?t.css("background-position","0 -77px"):40>=e?t.css("background-position","0 -52px"):75>=e?t.css("background-position","0 -26px"):t.css("background-position","0 0")}var ws4redis,pageSize=40,reconnectTry=0,sortableOptions={axis:"y",revert:!0,cursor:"move",scrollSpeed:5,delay:150,over:function(){$(this).find(".ui-sortable-helper").appendTo(this)}},customSlider={slide:function(e){e.element.slider({range:!0,min:0,max:e.max,values:e.values,create:function(){$("#time_start").html(humanizeSeconds(e.values[0])),$("#time_end").html(humanizeSeconds(e.values[1]))},slide:function(o,t){var r=$(this).children(".ui-slider-handle").first().offset(),i=$(this).children(".ui-slider-handle").last().offset();$(".tooltip-preview-timer-start").css("top",r.top+30).css("left",r.left-15).text(humanizeSeconds(t.values[0])),$(".tooltip-preview-timer-end").css("top",i.top+30).css("left",i.left-15).text(humanizeSeconds(t.values[1])),$("#time_start").html(humanizeSeconds(t.values[0])),$("#time_end").html(humanizeSeconds(t.values[1])),0!==e.currentPlayerControl.getState()&&e.currentPlayerControl.seekTo({secondes:t.value,seekAhead:!1})},change:function(e,o){$("#time_start").html(humanizeSeconds(o.values[0])),$("#time_end").html(humanizeSeconds(o.values[1]))},start:function(){$(".tooltip-preview-timer-start, .tooltip-preview-timer-end").stop().fadeIn("fast")},stop:function(o,t){$(".tooltip-preview-timer-start, .tooltip-preview-timer-end").stop().fadeOut("fast"),0!==e.currentPlayerControl.getState()&&e.currentPlayerControl.seekTo({secondes:t.value,seekAhead:!0})}})}},tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var youtubePlayer={initialized:!1},previewYoutubePlayer={initialized:!1},youtubePlayerControl={play:function(e){if(youtubePlayer.initialized){var o={videoId:e.music_id,suggestedQuality:"default"};e.timer_start&&(o.startSeconds=e.timer_start),youtubePlayer.loadVideoById(o),$("#wrapper-youtube-player").stop().fadeIn(250)}},stop:function(){youtubePlayer.initialized&&(youtubePlayer.stopVideo(),$("#wrapper-youtube-player").stop().fadeOut(250))},volumeUp:function(){youtubePlayer.initialized&&youtubePlayer.setVolume(Math.min(youtubePlayer.getVolume()+10,100))},volumeDown:function(){youtubePlayer.initialized&&youtubePlayer.setVolume(Math.max(youtubePlayer.getVolume()-10,0))},setVolume:function(e){youtubePlayer.initialized&&youtubePlayer.setVolume(e)}},youtubePlayerPreviewControl={play:function(e){previewYoutubePlayer.initialized&&previewYoutubePlayer.cueVideoById({videoId:e.music_id,suggestedQuality:"default"})},stop:function(){previewYoutubePlayer.initialized&&previewYoutubePlayer.stopVideo()},seekTo:function(e){previewYoutubePlayer.initialized&&previewYoutubePlayer.seekTo(e.secondes,e.seekAhead)},getState:function(){return[-1,0,5].indexOf(previewYoutubePlayer.getPlayerState())>-1?0:previewYoutubePlayer.getPlayerState()}},iframeElement=document.querySelector("iframe#soundcloudPlayer"),iframeElementPreview=document.querySelector("iframe#soundcloudPreviewPlayer"),soundcloudPlayer=SC.Widget(iframeElement),soundcloudPreviewPlayer=SC.Widget(iframeElementPreview);soundcloudPlayer.initialized=!1,soundcloudPreviewPlayer.initialized=!1,soundcloudPlayer.bind(SC.Widget.Events.READY,function(){soundcloudPlayer.initialized=!0,getCookie("playerOpen")&&"true"===getCookie("playerOpen")&&roomVM.room()&&roomVM.room().currentMusic()&&"soundcloud"===roomVM.room().currentMusic().source()&&roomVM.openPlayer()}),soundcloudPreviewPlayer.bind(SC.Widget.Events.READY,function(){soundcloudPreviewPlayer.initialized=!0}),soundcloudPlayer.bind(SC.Widget.Events.ERROR,function(){$("iframe#soundcloudPlayer").is(":visible")&&console.error("Soundcloud error occured")}),soundcloudPreviewPlayer.bind(SC.Widget.Events.ERROR,function(){$("iframe#soundcloudPreviewPlayer").is(":visible")&&console.error("Soundcloud error occured")});var soundcloudPlayerControl={play:function(e){soundcloudPlayer.initialized&&($("#wrapper-soundcloud-player").stop().fadeIn(250),soundcloudPlayer.bind(SC.Widget.Events.PLAY,function(){soundcloudPlayer.seekTo(1e3*e.timer_start||0),soundcloudPlayer.unbind(SC.Widget.Events.PLAY)}),soundcloudPlayer.load("https://api.soundcloud.com/tracks/"+e.music_id,{buying:!1,visual:!0,hide_related:!0,auto_play:!0,callback:function(){soundcloudPlayer.setVolume(getCookie("volumePlayer")/100)}}))},stop:function(){soundcloudPlayer.initialized&&(soundcloudPlayer.pause(),$("#wrapper-soundcloud-player").stop().fadeOut(250))},volumeUp:function(){soundcloudPlayer.initialized&&soundcloudPlayer.getVolume(function(e){soundcloudPlayer.setVolume(Math.min(e+.1,1))})},volumeDown:function(){soundcloudPlayer.initialized&&soundcloudPlayer.getVolume(function(e){soundcloudPlayer.setVolume(Math.max(e-.1,0))})},setVolume:function(e){soundcloudPlayer.initialized&&soundcloudPlayer.setVolume(e/100)}},soundcloudPlayerPreviewControl={play:function(e){soundcloudPreviewPlayer.initialized&&soundcloudPreviewPlayer.load("https://api.soundcloud.com/tracks/"+e.music_id,{buying:!1,visual:!0,hide_related:!0})},stop:function(){soundcloudPreviewPlayer.initialized&&soundcloudPreviewPlayer.pause()},seekTo:function(e){soundcloudPreviewPlayer.initialized&&soundcloudPreviewPlayer.seekTo(1e3*e.secondes)},getState:function(){return 1}},playerControlWrapper={youtube:youtubePlayerControl,soundcloud:soundcloudPlayerControl},playerPreviewControlWrapper={youtube:youtubePlayerPreviewControl,soundcloud:soundcloudPlayerPreviewControl};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function o(e,o){return e.toFixed(o.decimals)}var t=function(o,r){this.$element=e(o),this.options=e.extend({},t.DEFAULTS,this.dataOptions(),r),this.init()};t.DEFAULTS={from:0,to:0,speed:1e3,refreshInterval:100,decimals:0,formatter:o,onUpdate:null,onComplete:null},t.prototype.init=function(){this.value=this.options.from,this.loops=Math.ceil(this.options.speed/this.options.refreshInterval),this.loopCount=0,this.increment=(this.options.to-this.options.from)/this.loops},t.prototype.dataOptions=function(){var e={from:this.$element.data("from"),to:this.$element.data("to"),speed:this.$element.data("speed"),refreshInterval:this.$element.data("refresh-interval"),decimals:this.$element.data("decimals")},o=Object.keys(e);for(var t in o){var r=o[t];"undefined"==typeof e[r]&&delete e[r]}return e},t.prototype.update=function(){this.value+=this.increment,this.loopCount+=1,this.render(),"function"==typeof this.options.onUpdate&&this.options.onUpdate.call(this.$element,this.value),this.loopCount>=this.loops&&(clearInterval(this.interval),this.value=this.options.to,"function"==typeof this.options.onComplete&&this.options.onComplete.call(this.$element,this.value))},t.prototype.render=function(){var e=this.options.formatter.call(this.$element,this.value,this.options);this.$element.text(e)},t.prototype.restart=function(){this.stop(),this.init(),this.start()},t.prototype.start=function(){this.stop(),this.render(),this.interval=setInterval(this.update.bind(this),this.options.refreshInterval)},t.prototype.stop=function(){this.interval&&clearInterval(this.interval)},t.prototype.toggle=function(){this.interval?this.stop():this.start()},e.fn.countTo=function(o){return this.each(function(){var r=e(this),i=r.data("countTo"),n=!i||"object"==typeof o,s="object"==typeof o?o:{},a="string"==typeof o?o:"start";n&&(i&&i.stop(),r.data("countTo",i=new t(this,s))),i[a].call(i)})}}),function(e){"function"==typeof define&&define.amd?define(["require","exports","knockout","jquery"],function(o,t,r,i){e(r,i)}):e(window.ko,jQuery)}(setupKoBootstrap);var storeCookie=null,getCookie=null,removeCookie=null;"undefined"!=typeof Storage?(storeCookie=new Function("key","value","localStorage.setItem(key, value);"),getCookie=new Function("key","return localStorage.getItem(key);"),removeCookie=new Function("key","localStorage.removeItem(key);")):(storeCookie=new Function("key","value","Cookies.set(key, value, {expires: 7});"),getCookie=new Function("key","return Cookies.get(key);"),removeCookie=new Function("key","Cookies.remove(key);")),getCookie("volumePlayer")||storeCookie("volumePlayer",10),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},jQuery.fn.noOpacity=function(){return this.css("opacity",0)},jQuery.fn.fullOpacity=function(){return this.css("opacity",1)},jQuery.fn.opacityToggle=function(){return this.css("opacity",function(e,o){return 1===o?0:1})};var afterMoveSortable=function(e){var o,t="";e.targetIndex<e.sourceParent().length-1?(t="above",o=e.sourceParent()[e.targetIndex+1].pk()):(t="below",o=e.sourceParent()[e.targetIndex-1].pk()),roomVM.postPlaylistSort(e.item.pk(),t,o)};ko.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},ko.virtualElements.allowedBindings.stopBinding=!0,ko.bindingHandlers.selectPicker={init:function(e,o,t){$(e).is("select")&&(ko.isObservable(o())&&($(e).prop("multiple")&&$.isArray(ko.utils.unwrapObservable(o()))?ko.bindingHandlers.selectedOptions.init(e,o,t):ko.bindingHandlers.value.init(e,o,t)),$(e).addClass("selectpicker").selectpicker())},update:function(e,o,t){if($(e).is("select")){var r=t().selectPickerOptions;if("undefined"!=typeof r&&null!==r){var i=r.optionsArray,n=r.disabledCondition||!1,s=r.resetOnDisabled||!1;ko.utils.unwrapObservable(i).length>0&&ko.bindingHandlers.options.update(e,i,t),n&&s&&$(e).selectpicker("val",$(e).children("option:first").val()),$(e).prop("disabled",n)}ko.isObservable(o())&&($(e).prop("multiple")&&$.isArray(ko.utils.unwrapObservable(o()))?ko.bindingHandlers.selectedOptions.update(e,o):ko.bindingHandlers.value.update(e,o)),$(e).selectpicker("refresh")}}},ko.subscribable.fn.trimmed=function(){return ko.computed({read:function(){return this()?this().trim():void 0},write:function(e){this(e?e.trim():null),this.valueHasMutated()},owner:this})},ko.bindingHandlers.visibleKeepDOM={init:function(e){$(e).children().each(function(){$(this).hide()})},update:function(e,o){var t=ko.unwrap(o());t?$(e).children("."+t.source()).show():$(e).children().each(function(){$(this).fadeOut(1e3)})}},$(function(){loginVM=new LoginViewModel,roomVM=new RoomViewModel,musicsLibraryVM=new LibraryViewModel,$(".ko-room").each(function(e){ko.applyBindings(roomVM,$(".ko-room")[e])}),$(".ko-library").each(function(e){ko.applyBindings(musicsLibraryVM,$(".ko-library")[e])}),$(".ko-login").each(function(e){ko.applyBindings(loginVM,$(".ko-login")[e])}),loginVM.getRooms(),getCookie("room_token")?setRoomConnexion(getCookie("room_token")):loginVM.isConnected(!1)}),$(document).on("click",".ordering-to-top, .ordering-move-up, .ordering-move-down, .ordering-to-bot",function(){var e=$(this).closest("tr").data("pkplaylisttrack"),o=$(this).data("action");roomVM.postPlaylistSort(e,o)}),$(document).ready(function(){$(window).resize(function(){$(window).width()>992&&resize()}),resize(),$(".overlay-playlist").hide(),$("#querySearch").autocomplete({minLength:2,source:function(e,o){$.getJSON("http://suggestqueries.google.com/complete/search?callback=?",{hl:"fr",ds:"yt",jsonp:"suggestCallBack",q:e.term,client:"youtube"}),suggestCallBack=function(e){var t=[];e[1].length>0?($.each(e[1],function(e,o){o[0]=o[0].substr(0,40),t.push({value:o[0]})}),t.length=8,o(t)):$("#querySearch").autocomplete("close")}},select:function(e,o){$(this).val(o.item.value).change(),$(e.target.form).submit()}}),$(document).on({mouseenter:function(){$(this).children(".icon-trash").children(".fa-trash-o").fullOpacity()},mouseleave:function(){$(this).children(".icon-trash").children(".fa-trash-o").noOpacity()}},".playlist-item"),$("#music_preview").on("hide.bs.modal",function(){Object.keys(playerPreviewControlWrapper).forEach(function(e){playerPreviewControlWrapper[e].stop()})})}),$("#slider-volume").slider({range:"min",min:0,max:100,create:function(){$("#slider-volume").slider("option","value",getCookie("volumePlayer"))},slide:function(e,o){updateVolume(o.value),displaySlider(o.value)},change:function(e,o){updateVolume(o.value),displaySlider(o.value)},start:function(){$(".tooltip-volume-player").stop().fadeIn(250)},stop:function(){$(".tooltip-volume-player").stop().fadeOut(250)}}),$("#player-wrapper").hover(function(){$(".player-child").not(".player-child-no-music").filter(":visible").length>0&&$("#wrapper-slider-volume").stop().fadeIn(300)},function(){$("#wrapper-slider-volume").stop().fadeOut(300)}),$("#icon-volume").click(function(){$("#slider-volume").slider("option","value",0)});